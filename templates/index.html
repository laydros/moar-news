<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moar News</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
    <header class="site-header">
        <h1>Moar News</h1>
        <div id="refresh-container">
            <button
                hx-post="/refresh"
                hx-target="#refresh-container"
                hx-swap="innerHTML"
                class="refresh-btn"
            >
                Refresh All
            </button>
        </div>
    </header>

    <main class="feeds-grid">
        {% for feed_data in feeds %}
        <section class="feed-column">
            <header class="feed-header">
                <h2>{{ feed_data.feed.name }}</h2>
                {% if let Some(error) = feed_data.feed.last_error %}
                <span class="feed-error" title="{{ error }}">!</span>
                {% endif %}
            </header>

            <div class="feed-content">
                <ul class="items-list" id="feed-{{ feed_data.feed.id }}-items">
                    {% for item in feed_data.items %}
                    <li class="item">
                        <a href="{{ item.link }}" target="_blank" rel="noopener" class="item-link">
                            {{ item.title }}
                        </a>
                        {% if let Some(discussion) = item.discussion_link %}
                        <a href="{{ discussion }}" target="_blank" rel="noopener" class="discussion-link" title="Discussion">
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                <path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/>
                            </svg>
                        </a>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>

                {% if feed_data.has_more %}
                <div class="load-more-container" id="feed-{{ feed_data.feed.id }}-more">
                    <button
                        hx-get="/feed/{{ feed_data.feed.id }}/more?offset=15"
                        hx-target="this"
                        hx-swap="outerHTML"
                        class="load-more-btn"
                    >
                        Show More
                    </button>
                </div>
                {% endif %}
            </div>
        </section>
        {% endfor %}
    </main>

    <footer class="site-footer">
        <p>Powered by RSS</p>
    </footer>

    <script>
        function toggleItems(btn) {
            const feedId = btn.dataset.feedId;
            const itemsList = document.getElementById(`feed-${feedId}-items`);
            const extraItems = itemsList.querySelectorAll('.extra-item');
            const isExpanded = btn.dataset.expanded === 'true';

            if (isExpanded) {
                // Collapse: hide extra items
                extraItems.forEach(item => item.classList.add('hidden'));
                btn.textContent = 'Show More';
                btn.dataset.expanded = 'false';
            } else {
                // Expand: show extra items
                extraItems.forEach(item => item.classList.remove('hidden'));
                btn.textContent = 'Show Less';
                btn.dataset.expanded = 'true';
            }
        }
    </script>
</body>
</html>
